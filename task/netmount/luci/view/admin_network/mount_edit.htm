<%-
	local uci = require "luci.model.uci".cursor()
	local ds = require "luci.dispatcher"
	local server, folder, username, password
	local section = "netmount"

	uci:check_cfg("cron")
	
	if luci.http.formvalue("save") then
		server = luci.http.formvalue("server")
		folder = luci.http.formvalue("folder")
		username = luci.http.formvalue("username")
		password = luci.http.formvalue("password")
		if server and folder then
			if not uci:get("cron", section) then
				section = uci:section("cron", "cron", section)
			end
			uci:set("cron", section, "server", server)
			uci:set("cron", section, "folder", folder)
			if username and password then
				uci:set("cron", section, "username", username)
				uci:set("cron", section, "password", password)
			else
				uci:delete("cron", section, "username")
				uci:delete("cron", section, "password")
			end

			uci:save("cron")
		end

		require "os".execute("echo 'asdfasdf' >> /tmp/aaaaaa")
		luci.http.redirect(ds.build_url("admin","network","mount","mount_edit"))
		return
	else
		server = uci:get("cron", section, "server")
		folder = uci:get("cron", section, "folder")
		username = uci:get("cron", section, "username")
		password = uci:get("cron", section, "password")
	end
-%>

<%+header%>
<style type="text/css">
label{margin-left:5px;}
table{table-layout:fixed;}
table td{text-align:left;}
.sub_menu{padding-left:60px;}
.error-tip {color:#b94a48;}
#change_password td{text-align:left;}
.password-strength .meter {
margin: 4px 0;
height: 5px;
background: #f5f5f5;
}
</style>

<script type="text/javascript" src="<%=resource_cbi_js%>"></script>
<script language=javascript type="text/javascript" src="<%=resource%>/jquery-1.9.1.min.js"></script>
<script language="JavaScript" type="text/JavaScript">
function server_check()
{
	var obj = document.getElementById("server");
	var val = obj.value;
	if (!cbi_validators["abc_ip4addr"](val)) {
		obj.className += ' cbi-input-invalid';
		document.getElementById("server.tip").style.display = "";
		return false;
	} else {
		obj.className = obj.className.replace(/ cbi-input-invalid/g, '');
		document.getElementById("server.tip").style.display = "none";
		return true;
	}
}
function folder_check()
{
	var obj = document.getElementById("folder");
	var val = obj.value;
	if (val.length == 0 || val.match(/[\<\>\|\*\?\/]/)) {
		obj.className += ' cbi-input-invalid';
		document.getElementById("folder.tip").style.display = "";
		return false;
	} else {
		obj.className = obj.className.replace(/ cbi-input-invalid/g, '');
		document.getElementById("folder.tip").style.display = "none";
		return true;
	}
}
function form_check(form)
{
	var server_flag, folder_flag;

	if(form.state=="cancel")
	{
		form.action = form.action+"?action=cancel";
		return true;
	}

	server_flag = server_check();
	folder_flag = folder_check();
	if(server_flag && folder_flag)
	{
		form.action = form.action+"?action=save";
		return true;
	}
	else
	{
		alert("<%:Some fields are invalid, cannot save values!%>");
		return false;
	}
}
</script>

<fieldset class="cbi-section">
	<form method="post" name="config" action="<%=REQUEST_URI%>" enctype="multipart/form-data" onsubmit="return form_check(this);">
		<table>
			<colgroup>
				<col style="width:40%">
				<col style="width:26%">
				<col style="width:34%">
			</colgroup>
			<tr>
				<td><%:Server Address%></td>
				<td><input type="text" class="cbi-input-text"<%=ifattr(server,"value",server)%> name="server" id="server" onblur="server_check();" onkeyup="server_check();"/></td>
				<td id="server.tip" class="error-tip" style="display:none;"><%:Class A/B/C IPv4 address, Example: 192.168.1.1%></td>
			</tr>
			<tr>
				<td><%:Folder Name%></td>
				<td><input type="text" class="cbi-input-text"<%=ifattr(folder,"value",folder)%> name="folder" id="folder" onblur="folder_check();" onkeyup="folder_check();"></td>
				<td id="folder.tip" class="error-tip" style="display:none;"><%:Folder name can not be empty and can not contain characters(/<>*|?)%></td>
			</tr>
			<tr>
				<td><%:Username%></td>
				<td><input type="text" class="cbi-input-text"<%=ifattr(username,"value",username)%> name="username" id="username"/></td>
				<td></td>
			</tr>
			<tr>
				<td><%:Password%></td>
				<td><input type="password" class="cbi-input-text"<%=ifattr(password,"value",password)%> name="password" id="password"/><img src="<%=resource%>/cbi/hide.png" style="vertical-align:middle;margin-left:5px;" title="<%:Reveal/hide password%>" onclick="var e = document.getElementById('password'); e.type = (e.type=='password') ? 'text' : 'password'; this.src = (e.type=='password') ? '<%=resource%>/cbi/hide.png' : '<%=resource%>/cbi/show.png';" /></td>
				<td></td>
			</tr>
			<tr>
				<td></td>
				<td style="text-align:center;">
					<div class="cbi-page-actions" style="width:200px;">
					<input class="cbi-button" type="submit" name="cancel" value="<%:Cancel%>" onclick="this.form.state='cancel';return true;"/>
					<input class="cbi-button cbi-button-save" type="submit" name="save" id="save" value="<%:Save%>" />
					<input class="cbi-button" type="reset" value="<%:Reset%>" />
					</div>
				</td>
				<td></td>
			</tr>
		</table>
	</form>
</fieldset>
<%+footer%>
