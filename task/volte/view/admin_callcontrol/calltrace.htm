<%+header%>
<script language="JavaScript" type="text/JavaScript">//<![CDATA[
	<% if luci.version.license and (luci.version.license.fxs or luci.version.license.fxo) and (luci.version.license.gsm or luci.version.license.lte or luci.version.license.volte) then %>
		var mod = ['sipstack','sipmsg','fxso','gsm','dsp','voice'];
	<% elseif luci.version.license and (luci.version.license.fxs or luci.version.license.fxo) then %>
		var mod = ['sipstack','sipmsg','fxso','dsp','voice'];
	<% elseif luci.version.license and (luci.version.license.gsm or luci.version.license.lte or luci.version.license.volte) then %>
		var mod = ['sipstack','sipmsg','gsm','dsp','voice'];
	<% else %>
		var mod = ['sipstack','sipmsg','fxso','gsm','dsp','voice'];
	<% end %>
	window.onload = function()
	{
	<% if "calltrace_working" == calltrace_status or "stop" == calltrace_status then %>
		var o = "<%=calltrace_options%>"
		for(i = 0;i < mod.length;i++)
		{
			if(o.indexOf(mod[i]) >= 0)
				document.getElementById("trace."+mod[i]).checked="checked"
		}
		change_form('<%=calltrace_status%>')
	<% end %>
	}
	function set_all_status(status)
	{
		var tmr = window.setInterval(function() {
			for(i = 0;i < mod.length;i++)
				document.getElementById("trace."+mod[i]).disabled=status

			clearInterval(tmr)
		},500)
	}

	function change_form(status)
	{
		if("calltrace_working" == status)
		{
			document.getElementById('calltrace_start').style.display="none"
			document.getElementById('calltrace_end').style.display=""
			document.getElementById('calltrace_info').style.display=""
			set_all_status("disabled")
		}
		else if("stop" == status)
		{
			document.getElementById('calltrace_start').style.display=""
			document.getElementById('calltrace_end').style.display="none"
			document.getElementById('calltrace_info').style.display="none"
			set_all_status("")
		}
		return true
	}
	function calltrace_check()
	{
		var cnt = 0
		for(i = 0;i < mod.length;i++)
		{
			if(document.getElementById("trace."+mod[i]).checked)
				cnt++
		}
		if(cnt > 0)
			document.getElementById("calltrace_start").disabled=""
		else
			document.getElementById("calltrace_start").disabled="disabled"
	}
</script>
<iframe style="width:0; height:0; margin-top:-10px;" name="submitFrame" src="about:blank"></iframe>
<h2><a id="content" name="content"><%:Call Control / Diagnostics%></a></h2>
<form method="post" action="<%=REQUEST_URI%>" target="submitFrame" enctype="multipart/form-data">
<fieldset class="cbi-section">
	<legend><%:Call Trace%></legend>
	<div id="call_trace_option" class="cbi-value">
		<div class="cbi-value-title" style="width:30%"><label><%:Select the module you want to trace%></label></div>
		<div class="cbi-value-field" style="width:70%">
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.sipstack"  name="trace.sipstack"/>
			<label for="trace.sipstack"><%:SIP Stack%></label>
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.sipmsg" name="trace.sipmsg"/>
			<label for="trace.sipmsg"><%:SIP Message%></label>
			<% if luci.version.license and (luci.version.license.fxs or luci.version.license.fxo) then %>
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.fxso" name="trace.fxso"/>
			<label for="trace.fxso">FXS/FXO</label>
			<% end %>
			<% if luci.version.license and (luci.version.license.gsm or luci.version.license.lte or luci.version.license.lte) then %>
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.gsm"  name="trace.gsm"/>
			<label for="trace.gsm">GSM/LTE/VoLTE</label>
			<% end %>
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.dsp" name="trace.dsp" />
			<label for="trace.dsp">DSP</label>
			<input class="cbi-input-checkbox" type="checkbox" onclick="calltrace_check()" id="trace.voice" name="trace.voice" />
			<label for="trace.voice"><%:Voice%></label>
		</div>
	</div>
</fieldset>
<fieldset class="cbi-section" id="calltrace_info" style="display:none">
	<span><%:Call Trace is working...%></span>
	<img src="<%=resource%>/icons/loading.gif" alt="<%:Loading%>" style="vertical-align:middle" />
</fieldset>
<div class="cbi-page-actions">
	<input class="cbi-button cbi-button-apply" type="submit" value="<%:Start%>" id="calltrace_start" name="calltrace_start" onclick="return change_form('calltrace_working')"/>
	<input class="cbi-button cbi-button-apply" type="submit" value="<%:Stop & Download%>" id="calltrace_end" name="calltrace_end" onclick="change_form('stop')" />
</div>
</form>
<%+footer%>
