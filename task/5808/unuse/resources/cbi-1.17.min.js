var cbi_d=[];var cbi_t=[];var cbi_c=[];function ip2number(d){var c=d.split(".");var a=0;for(num in c){a=(a<<8)+parseInt(c[num])}return a}function isdiff(c,a){var g=false;var l=c;var e=c;var k=a;var d=a;if(c.indexOf("-")>0){var h=c.split("-");l=h[0];e=h[1]}if(a.indexOf("-")>0){var f=a.split("-");k=f[0];d=f[1]}if(parseInt(e)<parseInt(k)){g=true}if(parseInt(l)>parseInt(d)){g=true}return g}var cbi_validators={integer:function(a){return a.match(/^-?[0-9]+$/)!=null},uinteger:function(a){return cbi_validators.integer(a)&&a>=0},"float":function(a){return !isNaN(parseFloat(a))},ufloat:function(a){return cbi_validators["float"](a)&&a>=0},ipaddr:function(a){return cbi_validators.ip4addr(a)||cbi_validators.ip6addr(a)},neg_ipaddr:function(a){return cbi_validators.ip4addr(a.replace(/^\s*!/,""))||cbi_validators.ip6addr(a.replace(/^\s*!/,""))},ip4addr:function(a){if(a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)(\/(\d+))?$/)){return RegExp.$1>=0&&RegExp.$1<=255&&RegExp.$2>=0&&RegExp.$2<=255&&RegExp.$3>=0&&RegExp.$3<=255&&RegExp.$4>=0&&RegExp.$4<=255&&(!RegExp.$5||RegExp.$6>=0&&RegExp.$6<=32)}return false},abc_ip4addr:function(a,d){var e=""+d;e=e.split("&");for(var c=0;c<e.length;c++){if(a==e[c]){return true}}if(a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)(\/(\d+))?$/)){return RegExp.$1>0&&RegExp.$1<224&&RegExp.$1!=127&&RegExp.$2>=0&&RegExp.$2<=255&&RegExp.$3>=0&&RegExp.$3<=255&&RegExp.$4>0&&RegExp.$4<255&&(!RegExp.$5||RegExp.$6>0&&RegExp.$6<=32)}return false},ip4addrrange:function(a){if(a&&a!=""){var c=a.split("-");if(c&&c.length==2){if(cbi_validators.abc_ip4addr(c[0])&&cbi_validators.abc_ip4addr(c[1])){return true}}else{if(c&&c.length==1){return cbi_validators.abc_ip4addr(c[0])}}return false}return true},dhcp_addrpool:function(e,a){if(e&&cbi_validators.abc_ip4addr(e)){var d=a[0];var g=a[1];var k=ip2number(d)&ip2number(g);var c=ip2number(e)&ip2number(g);if(k!=c){return false}var h=document.getElementById("cbid.dhcp.lan.start");var f=document.getElementById("cbid.dhcp.lan.limit");if(h&&f){if(parseInt(ip2number(h.value))<parseInt(ip2number(f.value))){if(k==(ip2number(h.value)&ip2number(g))){h.className=h.className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.dhcp.lan.start.tip").style.display="none"}if(k==(ip2number(f.value)&ip2number(g))){f.className=f.className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.dhcp.lan.limit.tip").style.display="none"}return true}else{return false}}}return false},dhcp_gateway:function(e,a){if(e&&cbi_validators.abc_ip4addr(e)){var d=a[0];var f=a[1];var g=ip2number(d)&ip2number(f);var c=ip2number(e)&ip2number(f);if(g==c){return true}}return false},neg_ip4addr:function(a){return cbi_validators.ip4addr(a.replace(/^\s*!/,""))},ip6addr:function(a){if(a.match(/^([a-fA-F0-9:.]+)(\/(\d+))?$/)){if(!RegExp.$2||RegExp.$3>=0&&RegExp.$3<=128){var g=RegExp.$1;if(g=="::"){return true}if(g.indexOf(".")>0){var f=g.lastIndexOf(":");if(!(f&&cbi_validators.ip4addr(g.substr(f+1)))){return false}g=g.substr(0,f)+":0:0"}if(g.indexOf("::")>=0){var d=0;var e="0";for(var c=1;c<g.length-1;c++){if(g.charAt(c)==":"){d++}}if(d>7){return false}for(var c=0;c<7-d;c++){e+=":0"}if(g.match(/^(.*?)::(.*?)$/)){g=(RegExp.$1?RegExp.$1+":":"")+e+(RegExp.$2?":"+RegExp.$2:"")}}return g.match(/^(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}$/)!=null}}return false},port:function(a){return cbi_validators.integer(a)&&a>0&&a<=65535},serviceport:function(m,h){if(!cbi_validators.port(m)){return false}var k=""+h;k=k.split("&");for(var e=0;e<k.length;e++){if(m==k[e]){return false}else{if(k[e].match(/^(\d+)-(\d+)$/)){var n=RegExp.$1;var l=RegExp.$2;if(parseInt(m,10)>=parseInt(n,10)&&parseInt(m,10)<=parseInt(l,10)){return false}}}}var d=new Array();var a=new Array();var g=["_http","_https","_telnet","_ssh"];var f=0;for(var e=0;e<g.length;e++){d[e]=document.getElementById("cbid.lucid.main."+g[e])}for(var e=0;e<g.length;e++){a[e]=0;for(var c=0;c<g.length;c++){if(e!=c&&d[e].value==d[c].value){a[e]=1;a[c]=1}}}for(var e=0;e<g.length;e++){if(a[e]){if(d[e].className.match(/cbi\-input\-invalid/)==null){d[e].className+=" cbi-input-invalid";document.getElementById("cbid.lucid.main."+g[e]+".tip").style.display=""}if(m==d[e].value){f=1}}else{d[e].className=d[e].className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.lucid.main."+g[e]+".tip").style.display="none"}}if(f){return false}else{return true}},upnpexport:function(m,h){if(!cbi_validators.port(m)){return false}var k=""+h;k=k.split("&");for(var e=0;e<k.length;e++){if(m==k[e]){return false}}var g=document.getElementById("cbid.upnpc.service.http_port");var c=document.getElementById("cbid.upnpc.service.https_port");var a=document.getElementById("cbid.upnpc.service.telnet_port");var d=document.getElementById("cbid.upnpc.service.ssh_port");var f=0;if(g&&g.value==m){f=f+1}if(c&&c.value==m){f=f+1}if(a&&a.value==m){f=f+1}if(d&&d.value==m){f=f+1}if(f>1){return false}else{if(g){g.className=g.className.replace(/cbi-input-invalid/g,"");var l=document.getElementById("cbid.upnpc.service.http_port.tip");if(l){l.style.display="none"}}if(c){c.className=c.className.replace(/cbi-input-invalid/g,"");var l=document.getElementById("cbid.upnpc.service.https_port.tip");if(l){l.style.display="none"}}if(a){a.className=a.className.replace(/cbi-input-invalid/g,"");var l=document.getElementById("cbid.upnpc.service.telnet_port.tip");if(l){l.style.display="none"}}if(d){d.className=d.className.replace(/cbi-input-invalid/g,"");var l=document.getElementById("cbid.upnpc.service.ssh_port.tip");if(l){l.style.display="none"}}return true}},portrange:function(a){if(a.match(/^(\d+)-(\d+)$/)){var d=RegExp.$1;var c=RegExp.$2;return cbi_validators.port(d)&&cbi_validators.port(c)&&parseInt(d,10)<=parseInt(c,10)}else{return cbi_validators.port(a)}},dif_portrange:function(a,c){if(!cbi_validators.portrange(a)){return false}var e=""+c;e=e.split("&");for(var d=0;d<e.length;d++){if(!isdiff(a,e[d])){return false}}return true},macaddr:function(a){return a.match(/^([a-fA-F0-9]{2}:){5}[a-fA-F0-9]{2}$/)!=null},unicast_macaddr:function(a){return a.match(/^([fF]{2}:){5}[fF]{2}$/)==null&&a.match(/^[a-fA-F0-9][0248aceACE]:([a-fA-F0-9]{2}:){4}[a-fA-F0-9]{2}$/)!=null},host:function(a){return cbi_validators.hostname(a)||cbi_validators.ipaddr(a)},hostname:function(a){if(a.length<=24&&a.length>0){return a.match(/^[a-zA-Z]+$/)!=null||a.match(/^[a-zA-Z0-9][a-zA-Z0-9\-.]*[a-zA-Z0-9]$/)&&a.match(/[^0-9.]/)}return false},network:function(a){return cbi_validators.uciname(a)||cbi_validators.host(a)},wpakey:function(a){if(a.length==64){return a.match(/^[a-fA-F0-9]{64}$/)!=null}else{return a.length>=8&&a.length<=63}},wepkey:function(a){if(a.substr(0,2)=="s:"){a=a.substr(2)}if(a.length==10||a.length==26){return a.match(/^[a-fA-F0-9]{10,26}$/)!=null}else{return a.length==5||a.length==13}},cfgname:function(a){if(a.length==0||a.length>32){return false}return true},abc_ip4addr_domain:function(a){if(a.length>64||a.length<3){return false}if(a.match(/^[0-9\.]+$/)){return cbi_validators.abc_ip4addr(a)}else{if(a.match(/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/)){return true}else{return false}}},domain:function(a){if(a.length>64||a.length<3){return false}if(a.match(/^[0-9\.]+$/)==null&&a.match(/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/)){return true}else{return false}},extension:function(a,c){if(a.match(/^[0-9]+$/)==null){return false}var e=""+c;e=e.split("&");for(var d=0;d<e.length;d++){if(a==e[d]){return false}}return true},localport:function(a,c){if(isNaN(a)||parseInt(a)>=65535||parseInt(a)<=1){return false}var e=""+c;e=e.split("&");for(var d=0;d<e.length;d++){if(a==e[d]){return false}}return a.match(/^[0-9]+$/)!=null},numberprefix:function(a){if(a==""){return true}if(a.length>32){return false}if(a.length==1){if(a.match(/[0-9a-zA-Z]/)==null){return false}else{return true}}if(a.match(/^[0-9a-zA-Z\+\*]+[0-9a-zA-Z\+\*\|]*[0-9a-zA-Z]+$/)==null){return false}var d=a.split("|");for(var c=0;c<d.length;c++){if(d[c]==""){return false}if(d[c].length>=33){return false}for(j=0;j<d.length;j++){if(j!=c&&d[c]==d[j]||d[j]==""){return false}}if(null==d[c].match(/^[\*\+]*[0-9]+$/)){return false}}return true},phonenumber:function(a){if(a.length==1){if(a.match(/[0-9a-zA-Z\*\#\+]/)==null){return false}else{return true}}if(a.length>32){return false}if(a.match(/^[0-9a-zA-Z\*\+\#]+[0-9a-zA-Z]*[0-9a-zA-Z\*\#]+$/)==null){return false}return true},pincode:function(a){if(a.length<4||a.length>8||a.match(/^[0-9]+$/)==null){return false}return true},numberrange:function(d){if(d==""){return true}if(d.length>32){return false}if(d.match(/^\d*[0-9\|\-]*\d+$/)==null){return false}var l=d.split("|");for(var h=0;h<l.length;h++){if(l[h]==""){return false}for(var f=0;f<l.length;f++){if(f!=h&&l[h]==l[f]||l[f]==""){return false}}if(l[h].match(/^(\d+)\-(\d+)$/)){var g=parseInt(RegExp.$1,10);var a=parseInt(RegExp.$2,10);if(g>=1&&g<=32&&a>=1&&a<=32&&g<=a){for(var c=0;c<l.length;c++){if(c!=h){e=parseInt(l[c]);if(!isNaN(e)&&e>=g&&e<=a){return false}}}continue}else{return false}}else{if(l[h].match(/^\d+$/)){var e=parseInt(l[h]);if(!isNaN(e)){if(e<1||e>32){return false}}}else{return false}}}return true},uciname:function(a){return a.match(/^[a-zA-Z0-9_]+$/)!=null},neg_network_ip4addr:function(a){a=a.replace(/^\s*!/,"");return cbi_validators.uciname(a)||cbi_validators.ip4addr(a)},cidr:function(a){if("0.0.0.0"==a||"0.0.0.0/0"==a||"0.0.0.0/0.0.0.0"==a){return true}if(a.match(/^\d+\.\d+\.\d+\.\d+$/)||a.match(/^\d+\.\d+\.\d+\.\d+\/\d+$/)){return cbi_validators.abc_ip4addr(a)}else{if(a.match(/^(\d+\.\d+\.\d+\.\d+)\/(\d+\.\d+\.\d+\.\d+)$/)){var d=RegExp.$1;var c=RegExp.$2;return cbi_validators.abc_ip4addr(d)&&cbi_validators.netmask(c)}else{return false}}},range:function(c,d){if(null==c.match(/^[0-9]+$/)){return false}var e=parseInt(d[0],10);var a=parseInt(d[1],10);var f=parseInt(c,10);if(!isNaN(e)&&!isNaN(a)&&!isNaN(f)){return f>=e&&f<=a}return false},min:function(a,c){if(a.length>5){return false}var d=parseInt(c[0]);var e=parseInt(a);if(!isNaN(d)&&!isNaN(e)){return e>=d}return false},max:function(c,d){if(c.length>5){return false}var a=parseInt(d[0]);var e=parseInt(c);if(!isNaN(a)&&!isNaN(e)){return e>=0&&e<=a}return false},neg:function(a,c){if(c[0]&&typeof cbi_validators[c[0]]=="function"){return cbi_validators[c[0]](a.replace(/^\s*!\s*/,""))}return false},uni_ssid:function(a){if(a.match(/^[a-zA-Z0-9_.-]+$/)!=null&&a.length<=32){return true}return false},list:function(d,e){var a=cbi_validators[e[0]||"string"];if(typeof a=="function"){var g=e.slice(1);var c=d.match(/[^\s]+/g);for(var f=0;f<c.length;f++){if(!a(c[f],g)){return false}}return true}return false},feature_code:function(a,c){var e=""+c;e=e.split("&");for(var d=0;d<e.length;d++){if(a==e[d]){return false}}if(a.match(/^\*[\*0-9]+$/)){return true}return false},url:function(a){if(a.match(/^tftp:\/\//)||a.match(/^ftp:\/\//)||a.match(/^http:\/\//)||a.match(/^https:\/\//)||a.match(/^ftps:\/\//)){return true}return false},notempty:function(a){if(a.length>0){return true}return false},digitmap:function(c){var a=false;var e=0;for(var d=0;d<c.length;d++){if(c[d].match(/[0-9*#A-D]/)){continue}else{if(c[d].match(/[\.\?\+x]/)){if(a){return false}}else{if("["==c[d]){if(a){return false}a=true}else{if("]"==c[d]){if(!a){return false}a=false}else{if("-"==c[d]){if(!a){return false}}else{if("("==c[d]){if(a){return false}else{e++}}else{if(")"==c[d]){if(a||0==e){return false}else{e--}}else{if("|"==c[d]){if(a){return false}}else{return false}}}}}}}}}if(0!=e||a){return false}else{return true}},regular:function(c){var a=false;var f=0;var e=false;if(c.length>1024){return false}for(var d=0;d<c.length;d++){if(c[d].match(/[0-9a-zA-Z\^,\|*#]/)){continue}else{if(c[d].match(/[\.\*\$\?\+]/)){if(d>0&&c[d-1]=="\\"){return true}if(a){return false}if("?"==c[d]){e=true}}else{if("{"==c[d]){if(a){return false}a=true}else{if("}"==c[d]){if(!a){return false}a=false}else{if("["==c[d]){if(a){return false}a=true}else{if("]"==c[d]){if(!a){return false}a=false}else{if("-"==c[d]){if(!a){return false}}else{if("("==c[d]){if(a){return false}else{f++}}else{if(")"==c[d]){if(a||0==f){return false}else{f--}}else{if("!"==c[d]){if(!e){return false}}else{if("|"==c[d]){if(a){return false}}else{if("\\"==c[d]){if(d+1>=c.length){return false}}else{return false}}}}}}}}}}}}}if(0!=f||a){return false}else{return true}},regular_simple:function(a){if(a.length>32){return false}return cbi_validators.regular(a)},netmask:function(c){if(cbi_validators.ip4addr(c)){var e=c.split(".");var d=false;for(i=0;i<4;i++){for(j=0;j<8;j++){var a=128>>j&parseInt(e[i],10);if(0==a){d=true}if(a>0&&d){return false}}}return true}return false},wifi_password:function(a){if(a.match(/^[0-9a-zA-Z\~\!@#\$\%\^\&\*\(\)\-\_\=\+\[\{\]\}]{8,32}$/)){return true}return false},password:function(a){if(a.length>=8&&a.length<=32){return true}return false},wep_password:function(a){var c=document.getElementById("cbid.network_tmp.network.wifi_wep");if(c&&c.value=="64bit"){if(a.length==5){return true}else{return false}}else{if(a.length==13){return true}else{return false}}return false},gateway:function(a){if(cbi_validators.abc_ip4addr(a)){var f=document.getElementById("cbid.network.lan.ipaddr");var e=document.getElementById("cbi.combobox.cbid.network.lan.netmask")||document.getElementById("cbid.network.lan.netmask");var d=ip2number(f.value)&ip2number(e.value);var c=ip2number(a)&ip2number(e.value);if(d==c){return true}else{return false}}},wan_gateway:function(a){if(cbi_validators.abc_ip4addr(a)){var f=document.getElementById("cbid.network_tmp.network.wan_ipaddr");var e=document.getElementById("cbi.combobox.cbid.network_tmp.network.wan_netmask")||document.getElementById("cbid.network_tmp.network.wan_netmask");if(f.value==a){return false}var d=ip2number(f.value)&ip2number(e.value);var c=ip2number(a)&ip2number(e.value);if(d==c){return true}else{return false}}return false},lan_gateway:function(a){if(cbi_validators.abc_ip4addr(a)){var f=document.getElementById("cbid.network_tmp.network.lan_ipaddr");var e=document.getElementById("cbi.combobox.cbid.network_tmp.network.lan_netmask")||document.getElementById("cbid.network_tmp.network.lan_netmask");var d=ip2number(f.value)&ip2number(e.value);var c=ip2number(a)&ip2number(e.value);if(d==c){return true}else{return false}}return false},lan_addr:function(a){if(cbi_validators.abc_ip4addr(a)){var d=document.getElementById("cbid.network_tmp.network.wan_ipaddr");var e=document.getElementById("cbi.combobox.cbid.network_tmp.network.wan_netmask")||document.getElementById("cbid.network_tmp.network.wan_netmask");if(d&&e){var c=document.getElementById("cbi.combobox.cbid.network_tmp.network.lan_netmask")||document.getElementById("cbid.network_tmp.network.lan_netmask");var f=ip2number(d.value)&ip2number(e.value);var g=ip2number(a)&ip2number(c.value);if(f!=g){d.className=d.className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.network_tmp.network.wan_ipaddr.tip").style.display="none";return true}else{return false}}else{return true}}return false},wan_addr:function(a){if(cbi_validators.abc_ip4addr(a)){var e=document.getElementById("cbid.network_tmp.network.lan_ipaddr");var c=document.getElementById("cbi.combobox.cbid.network_tmp.network.lan_netmask")||document.getElementById("cbid.network_tmp.network.lan_netmask");var f=document.getElementById("cbi.combobox.cbid.network_tmp.network.wan_netmask")||document.getElementById("cbid.network_tmp.network.wan_netmask");var h=ip2number(e.value)&ip2number(c.value);var g=ip2number(a)&ip2number(f.value);if(g!=h){e.className=e.className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.network_tmp.network.lan_ipaddr.tip").style.display="none";var d=document.getElementById("cbid.network_tmp.network.wan_gateway");if(cbi_validators.abc_ip4addr(d.value)&&cbi_validators.wan_gateway(d.value)){d.className=d.className.replace(/ cbi-input-invalid/g,"");document.getElementById("cbid.network_tmp.network.wan_gateway.tip").style.display="none"}return true}else{return false}}return false},ivr_dtmf:function(d){var c=document.getElementsByTagName("select");var e=new Array();var a=0;for(i=0;i<c.length;i++){e[i]=0;if(c[i].id.match(/cbid\.ivr\.[a-z0-9]+\.dtmf$/)){for(j=0;j<c.length;j++){if(c[j].id.match(/cbid.ivr.[a-z0-9]+\.dtmf$/)&&c[i].id!=c[j].id&&c[i].value==c[j].value){e[i]=1;e[j]=1}}}}for(i=0;i<c.length;i++){if(e[i]){if(c[i].className.match(/cbi\-input\-invalid/)==null){c[i].className+=" cbi-input-invalid"}if(d==c[i].value){a=1}}else{if(c[i].id.match(/cbid.ivr.[a-z0-9]+\.dtmf$/)){c[i].className=c[i].className.replace(/ cbi-input-invalid/g,"")}}}if(a){return false}else{return true}},multi_ssid:function(a,c){if(a.match(/^[a-zA-Z0-9_.-]+$/)!=null&&a.length<=32){var e=""+c;e=e.split("&");for(var d=0;d<e.length;d++){if(a==e[d]){return false}}return true}return false},wlan_gateway:function(a){if(cbi_validators.abc_ip4addr(a)){var f=document.getElementById("cbid.network_tmp.network.wlan_ipaddr");var e=document.getElementById("cbi.combobox.cbid.network_tmp.network.wlan_netmask")||document.getElementById("cbid.network_tmp.network.wlan_netmask");if(f.value==a){return false}var d=ip2number(f.value)&ip2number(e.value);var c=ip2number(a)&ip2number(e.value);if(d==c){return true}else{return false}}return false}};function cbi_d_add(g,f,c){var e=document.getElementById(g);if(e){var d;for(var a=0;a<cbi_d.length;a++){if(cbi_d[a].id==g){d=cbi_d[a];break}}if(!d){d={node:e,id:g,parent:e.parentNode.id,next:c,deps:[]};cbi_d.unshift(d)}d.deps.push(f)}}function cbi_d_checkvalue(g,e){var d=document.getElementById(g);var f;if(!d){var a=document.getElementsByName(g);if(a.length>0&&a[0].type=="radio"){for(var c=0;c<a.length;c++){if(a[c].checked){f=a[c].value;break}}}f=f?f:""}else{if(!d.value){f=""}else{f=d.value;if(d.type=="checkbox"){f=d.checked?f:""}}}return f==e}function cbi_d_check(g){var c;var e=false;for(var d=0;d<g.length;d++){var f=true;c=false;for(var a in g[d]){if(a=="!reverse"){c=true}else{if(a=="!default"){e=true;f=false}else{f=f&&cbi_d_checkvalue(a,g[d][a])}}}if(f){return !c}}return e}function cbi_d_update(){var g=false;for(var a=0;a<cbi_d.length;a++){var d;var f=cbi_d[a];var c=document.getElementById(f.next);var e=document.getElementById(f.id);if(f.parent){d=document.getElementById(f.parent)}if(e&&e.parentNode&&!cbi_d_check(f.deps)){e.parentNode.removeChild(e);g=true;if(f.parent){cbi_c[f.parent]--}}else{if((!e||!e.parentNode)&&cbi_d_check(f.deps)){f.node.style.display="";if(!c){if(d){d.appendChild(f.node);g=true}}else{c.parentNode.insertBefore(f.node,c);g=true}if(f.parent){cbi_c[f.parent]++}}else{if("none"==f.node.style.display){f.node.style.display=""}}}}if(f&&f.parent){if(!cbi_t_update()){cbi_tag_last(d)}}if(g){cbi_d_update()}}function cbi_bind(c,a,e,d){if(!c.addEventListener){c.attachEvent("on"+a,function(){var f=window.event;if(!f.target&&f.srcElement){f.target=f.srcElement}return !!e(f)})}else{c.addEventListener(a,e,!!d)}return c}function cbi_combobox(c,n,f,e,o){var h="cbi.combobox."+c;if(document.getElementById(h)){return}var l=document.getElementById(c);var g=document.createElement("select");g.id=h;g.index=l.index;g.className=l.className.replace(/cbi-input-text/,"cbi-input-select");if(l.nextSibling){l.parentNode.insertBefore(g,l.nextSibling)}else{l.parentNode.appendChild(g)}var d=l.getAttribute("cbi_datatype");var m=l.getAttribute("cbi_optional");if(d){cbi_validate_field(g,m=="true",d)}var a="";if(!n[l.value]){if(l.value==""){a=a+"<option value=''>"+f+"</option>"}else{a=a+"<option value='"+l.value+"'>"+l.value+"</option>"}}for(var k in n){if(l.value==k){a=a+"<option value='"+k+"' selected='selected'>"+n[k]+"</option>"}else{a=a+"<option value='"+k+"'>"+n[k]+"</option>"}}a=a+"<option value=''>"+e+"</option>";g.innerHTML=a;l.style.display="none";cbi_bind(g,"change",function(){if(g.selectedIndex==g.options.length-1){l.style.display="inline";g.blur();g.parentNode.removeChild(g);l.focus()}else{l.value=g.options[g.selectedIndex].value}try{cbi_d_update()}catch(p){}});if(o){g.focus();g.blur()}}function cbi_combobox_init(f,a,c,e){var d=document.getElementById(f);cbi_bind(d,"blur",function(){cbi_combobox(f,a,c,e,true)});cbi_combobox(f,a,c,e,false)}function cbi_filebrowser(f,d,a){var e=document.getElementById(f);var c=window.open(d+(e.value||a||"")+"?field="+f,"luci_filebrowser","width=300,height=400,left=100,top=200,scrollbars=yes");c.focus()}function cbi_browser_init(h,g,c,a){function f(k){cbi_filebrowser(h,c,a);return false}var e=document.getElementById(h);var d=document.createElement("img");d.className="cbi-image-button";d.src=g+"/cbi/folder.gif";e.parentNode.insertBefore(d,e.nextSibling);cbi_bind(d,"click",f)}function cbi_dynsellist_init(a,l){function d(r){var s=[];for(var p=0;p<r.parentNode.childNodes.length;p++){if(r.parentNode.childNodes[p].name==a){s.push(r.parentNode.childNodes[p])}}var n=document.getElementsByName(a);var q=s[0].options.length;for(var p=0;p<s.length&&p<q;p++){s[p].id=a+"."+(p+1);s[p].nextSibling.src=l+(p+1<n.length||p+1==q?"/cbi/remove.png":"/cbi/add.png")}if(s.length<q){if(s.length>1&&"br"==s[s.length-1].nextSibling.nextSibling.tagName.toLowerCase()){var o=document.createElement("img");o.className="cbi-image-button";o.src=l+"/cbi/remove.png";s[s.length-1].parentNode.insertBefore(o,s[s.length-1].nextSibling);cbi_bind(o,"click",g)}if(s.length>1&&"img"==s[s.length-1].nextSibling.nextSibling.tagName.toLowerCase()){s[s.length-1].nextSibling.src=l+"/cbi/remove.png"}if(1==s.length&&"img"==s[s.length-1].nextSibling.nextSibling.tagName.toLowerCase()){s[s.length-1].parentNode.removeChild(s[s.length-1].nextSibling.nextSibling)}}r.focus()}function h(n){n=n?n:window.event;var o=n.target?n.target:n.srcElement;if(o.nodeType==3){o=o.parentNode}switch(n.keyCode){case 8:case 46:if(o.value.length==0){if(n.preventDefault){n.preventDefault()}return false}return true;case 13:case 38:case 40:if(n.preventDefault){n.preventDefault()}return false}return true}function k(A){A=A?A:window.event;var y=A.target?A.target:A.srcElement;if(y.nodeType==3){y=y.parentNode}var q=y.previousSibling;while(q&&q.name!=a){q=q.previousSibling}var u=y.nextSibling;while(u&&u.name!=a){u=u.nextSibling}switch(A.keyCode){case 8:case 46:var C=A.keyCode==8?q||u:u||q;if(C){if("img"==y.nextSibling.nextSibling.tagName.toLowerCase()){y.parentNode.removeChild(y.nextSibling.nextSibling.nextSibling)}y.parentNode.removeChild(y.nextSibling.nextSibling);y.parentNode.removeChild(y.nextSibling);y.parentNode.removeChild(y);d(C);if(A.preventDefault){A.preventDefault()}C.focus();return false}break;case 13:var p=document.createElement("select");p.className=y.className;p.name=y.name;p.id=y.id;var s=document.getElementsByName(a);var B=document.getElementById(s[s.length-1].id);var x=0;for(var t=0;t<s.length;t++){var w=s[t].selectedIndex;x|=1<<w}var r=0;for(var t=0;t<B.length;t++){p.options[t]=new Option(B.options[t].text,B.options[t].value);p.options[t].id=B.options[t].id+"."+s.length;if(0==r&&!(1<<t&x)){p.options[t].selected=true;r=1}}var z=document.createElement("img");cbi_bind(z,"click",g);if(u){y.parentNode.insertBefore(p,u);y.parentNode.insertBefore(z,u);y.parentNode.insertBefore(document.createElement("br"),u)}else{if("img"==y.nextSibling.nextSibling.tagName.toLowerCase()){y.parentNode.removeChild(y.nextSibling.nextSibling)}y.parentNode.appendChild(p);y.parentNode.appendChild(z);y.parentNode.appendChild(document.createElement("br"))}var o=y.getAttribute("cbi_datatype");var v=y.getAttribute("cbi_optional")=="true";if(o){cbi_validate_field(p,v,o)}d(p);break;case 38:if(q){q.focus()}break;case 40:if(u){u.focus()}break}return true}function g(n){n=n?n:window.event;var o=n.target?n.target:n.srcElement;if(o.src.indexOf("remove")>-1){k({target:o.previousSibling,keyCode:8})}else{var p=document.getElementsByName(a);if(1==p.length){k({target:o.previousSibling,keyCode:13})}else{k({target:o.previousSibling.previousSibling,keyCode:13})}}return false}var e=document.getElementsByName(a);if(e.length>0){var m=document.getElementById(e[e.length-1].id).length}for(var f=0;f<e.length;f++){var c=document.createElement("img");c.className="cbi-image-button";if(m>1){c.src=l+(f+1<e.length||f+1>=m?"/cbi/remove.png":"/cbi/add.png")}e[f].parentNode.insertBefore(c,e[f].nextSibling);cbi_bind(c,"click",g)}if(e.length>1&&e.length<m){var c=document.createElement("img");c.className="cbi-image-button";c.src=l+"/cbi/remove.png";e[e.length-1].parentNode.insertBefore(c,e[e.length-1].nextSibling);cbi_bind(c,"click",g)}}function cbi_dynlist_init(a,k){function g(r){var n=[];for(var p=0;p<r.parentNode.childNodes.length;p++){if(r.parentNode.childNodes[p].name==a){n.push(r.parentNode.childNodes[p])}}for(var p=0;p<n.length;p++){n[p].id=a+"."+(p+1);n[p].nextSibling.src=k+(p+1<n.length?"/cbi/remove.png":"/cbi/add.png")}var q=n.length-1;if(n.length>1&&"br"==n[q].nextSibling.nextSibling.tagName.toLowerCase()){var o=document.createElement("img");o.className="cbi-image-button";o.src=k+"/cbi/remove.png";n[q].parentNode.insertBefore(o,n[q].nextSibling);cbi_bind(o,"click",l)}if(n.length>1&&"img"==n[q].nextSibling.nextSibling.tagName.toLowerCase()){n[q].nextSibling.src=k+"/cbi/remove.png"}if(1==n.length&&"img"==n[q].nextSibling.nextSibling.tagName.toLowerCase()){n[q].parentNode.removeChild(n[q].nextSibling.nextSibling)}r.focus()}function e(n){n=n?n:window.event;var o=n.target?n.target:n.srcElement;if(o.nodeType==3){o=o.parentNode}switch(n.keyCode){case 8:case 46:if(o.value.length==0){if(n.preventDefault){n.preventDefault()}return false}return true;case 13:case 38:case 40:if(n.preventDefault){n.preventDefault()}return false}return true}function d(u){u=u?u:window.event;var t=u.target?u.target:u.srcElement;if(t.nodeType==3){t=t.parentNode}var q=t.previousSibling;while(q&&q.name!=a){q=q.previousSibling}var r=t.nextSibling;while(r&&r.name!=a){r=r.nextSibling}switch(u.keyCode){case 8:case 46:var w=u.keyCode==8?q||r:r||q;if(t.value.length==0&&w){if("img"==t.nextSibling.nextSibling.tagName.toLowerCase()){t.parentNode.removeChild(t.nextSibling.nextSibling.nextSibling)}t.parentNode.removeChild(t.nextSibling.nextSibling);t.parentNode.removeChild(t.nextSibling);t.parentNode.removeChild(t);g(w);if(u.preventDefault){u.preventDefault()}w.focus();return false}break;case 13:var p=document.createElement("input");p.name=t.name;p.type=t.type;var v=document.createElement("img");cbi_bind(p,"keydown",d);cbi_bind(p,"keypress",e);cbi_bind(v,"click",l);if(t.id.indexOf("date_options")>=0){cbi_bind(p,"click",setDate)}if(t.id.indexOf("time_options")>=0){cbi_bind(p,"click",setTime)}if(r){t.parentNode.insertBefore(p,r);t.parentNode.insertBefore(v,r);t.parentNode.insertBefore(document.createElement("br"),r)}else{if("img"==t.nextSibling.nextSibling.tagName.toLowerCase()){t.parentNode.removeChild(t.nextSibling.nextSibling)}t.parentNode.appendChild(p);t.parentNode.appendChild(v);t.parentNode.appendChild(document.createElement("br"))}var o=t.getAttribute("cbi_datatype");var s=t.getAttribute("cbi_optional")=="true";if(o){cbi_validate_field(p,s,o)}g(p);break;case 38:if(q){q.focus()}break;case 40:if(r){r.focus()}break}return true}function l(o){o=o?o:window.event;var p=o.target?o.target:o.srcElement;var q=document.getElementById("calender");if(q){q.parentNode.removeChild(q)}q=document.getElementById("timeSelPanel");if(q){q.parentNode.removeChild(q)}if(p.src.indexOf("remove")>-1){p.previousSibling.value="";d({target:p.previousSibling,keyCode:8})}else{var n=document.getElementsByName(a);if(1==n.length){d({target:p.previousSibling,keyCode:13})}else{d({target:p.previousSibling.previousSibling,keyCode:13})}}return false}var h=document.getElementsByName(a);for(var f=0;f<h.length;f++){var c=document.createElement("img");c.className="cbi-image-button";c.src=k+(f+1<h.length?"/cbi/remove.png":"/cbi/add.png");h[f].parentNode.insertBefore(c,h[f].nextSibling);cbi_bind(h[f],"keydown",d);cbi_bind(h[f],"keypress",e);cbi_bind(c,"click",l)}if(h.length>1){var m=h.length-1;var c=document.createElement("img");c.className="cbi-image-button";c.src=k+"/cbi/remove.png";h[m].parentNode.insertBefore(c,h[m].nextSibling);cbi_bind(c,"click",l)}}function cbi_hijack_forms(e,g,a,f){var c=e.getElementsByTagName("form");for(var d=0;d<c.length;d++){$(c[d]).observe("submit",function(h){h.stop();h.element().request({onSuccess:g,onFailure:a});if(f){f()}})}}function cbi_t_add(e,d){var a=document.getElementById("tab."+e+"."+d);var f=document.getElementById("container."+e+"."+d);if(a&&f){cbi_t[e]=cbi_t[e]||[];cbi_t[e][d]={tab:a,container:f,cid:f.id}}}function cbi_t_switch(f,c){if(cbi_t[f]&&cbi_t[f][c]){var g=cbi_t[f][c];var a=document.getElementById("tab."+f);for(var e in cbi_t[f]){var d=cbi_t[f][e];if(g.tab.id!=d.tab.id){d.tab.className=d.tab.className.replace(/(^| )cbi-tab( |$)/," cbi-tab-disabled ");d.container.style.display="none"}else{if(a){a.value=c}d.tab.className=d.tab.className.replace(/(^| )cbi-tab-disabled( |$)/," cbi-tab ");d.container.style.display="block"}}}return false}function cbi_t_update(){var d=[];var c=false;for(var a in cbi_t){for(var f in cbi_t[a]){if(cbi_c[cbi_t[a][f].cid]==0){cbi_t[a][f].tab.style.display="none"}else{if(cbi_t[a][f].tab&&cbi_t[a][f].tab.style.display=="none"){cbi_t[a][f].tab.style.display="";var e=cbi_t[a][f].tab;e.className+=" cbi-tab-highlighted";d.push(e)}}cbi_tag_last(cbi_t[a][f].container);c=true}}if(d.length>0){window.setTimeout(function(){for(var g=0;g<d.length;g++){d[g].className=d[g].className.replace(/ cbi-tab-highlighted/g,"")}},750)}return c}function cbi_validate_form(e,f){if(e.cbi_state=="add-section"||e.cbi_state=="del-section"){return true}var d=false;if(e.cbi_validators){for(var c=0;c<e.cbi_validators.length;c++){var a=e.cbi_validators[c];if(!a()){d=true}}}if(true==d){alert(f);return false}return true}function cbi_validate_reset(a){window.setTimeout(function(){cbi_validate_form(a,null)},100);return true}function cbi_validate_field(e,g,l){var k=typeof e=="string"?document.getElementById(e):e;var c;var f;if(l.match(/^(\w+)\(([^\(\)]*)\)/)){f=RegExp.$1;c=RegExp.$2.split(/\s*,\s*/)}else{f=l}var d=cbi_validators[f];if(k&&d){var a=function(){if(k.form){k.className=k.className.replace(/ cbi-input-invalid/g,"");var m=document.getElementById(e+".tip");if(k.id.match(/^cbi\.combobox\./)){var n=k.id.replace(/cbi\.combobox\./g,"")+".tip";m=document.getElementById(n)}if(m){m.style.display="none"}var o=k.options&&k.options.selectedIndex>-1?k.options[k.options.selectedIndex].value:k.value;if(k.nodeName=="SELECT"&&o.length==0){return true}if(!(o.length==0&&g||d(o,c))){k.className+=" cbi-input-invalid";cbi_bind(k,"keyup",a);if(m){m.style.display="table"}return false}}return true};if(!k.form.cbi_validators){k.form.cbi_validators=[]}k.form.cbi_validators.push(a);cbi_bind(k,"blur",a);if(k.nodeName=="SELECT"){cbi_bind(k,"change",a);cbi_bind(k,"click",a)}k.setAttribute("cbi_validate",a);k.setAttribute("cbi_datatype",l);k.setAttribute("cbi_optional",(!!g).toString());var h=document.getElementById("cbi.combobox."+k.id);if(h){cbi_validate_field(h,g,l)}}}function cbi_row_swap(c,d,k){var g=c.parentNode;while(g&&g.nodeName.toLowerCase()!="tr"){g=g.parentNode}if(!g){return false}var m=g.parentNode;while(m&&m.nodeName.toLowerCase()!="table"){m=m.parentNode}if(!m){return false}var n=d?3:2;var f=d?m.rows.length:m.rows.length-1;for(var l=n;l<f;l++){if(m.rows[l]==g){if(d){g.parentNode.insertBefore(m.rows[l],m.rows[l-1])}else{g.parentNode.insertBefore(m.rows[l+1],m.rows[l])}break}}var a=[];for(l=2;l<m.rows.length;l++){m.rows[l].className=m.rows[l].className.replace(/cbi-rowstyle-[12]/,"cbi-rowstyle-"+(1+l%2));if(m.rows[l].id&&m.rows[l].id.match(/-([^\-]+)$/)){a.push(RegExp.$1)}}var h=document.getElementById(k);if(h){h.value=a.join(" ")}return false}function cbi_tag_last(a){var e;for(var d=0;d<a.childNodes.length;d++){var f=a.childNodes[d];if(f.nodeType==1&&f.nodeName.toLowerCase()=="div"){f.className=f.className.replace(/ cbi-value-last$/,"");e=f}}if(e){e.className+=" cbi-value-last"}}if(!String.serialize){String.serialize=function(e){switch(typeof e){case"object":if(e==null){return"null"}else{if(e.length){var c,d="";for(var c=0;c<e.length;c++){d+=(d?", ":"")+String.serialize(e[c])}return"[ "+d+" ]"}else{var a,d="";for(a in e){d+=(d?", ":"")+a+": "+String.serialize(e[a])}return"{ "+d+" }"}}break;case"string":if(e.match(/[^a-zA-Z0-9_,.: -]/)){return'decodeURIComponent("'+encodeURIComponent(e)+'")'}else{return'"'+e+'"'}break;default:return e.toString()}}}if(!String.format){String.format=function(){if(!arguments||arguments.length<1||!RegExp){return}var o=[/&/g,"&#38;",/"/g,"&#34;",/'/g,"&#39;",/</g,"&#60;",/>/g,"&#62;"];var p=[/"/g,"&#34;",/'/g,"&#39;"];function F(m,K){for(var a=0;a<K.length;a+=2){m=m.replace(K[a],K[a+1])}return m}var s=arguments[0];var y="";var q=/^(([^%]*)%('.|0|\x20)?(-)?(\d+)?(\.\d+)?(%|b|c|d|u|f|o|s|x|X|q|h|j|t|m))/;var H=b=[],e=0,k=0;while(H=q.exec(s)){var t=H[1];var r=H[2],C=H[3],I=H[4],B=H[5];var w=H[6],n=H[7];k++;if(n=="%"){g="%"}else{if(e++<arguments.length){var h=arguments[e];var D="";if(C&&C.substr(0,1)=="'"){D=r.substr(1,1)}else{if(C){D=C}}var A=true;if(I&&I==="-"){A=false}var E=-1;if(B){E=parseInt(B)}var z=-1;if(w&&n=="f"){z=parseInt(w.substring(1))}var g=h;switch(n){case"b":g=(parseInt(h)||0).toString(2);break;case"c":g=String.fromCharCode(parseInt(h)||0);break;case"d":g=parseInt(h)||0;break;case"u":g=Math.abs(parseInt(h)||0);break;case"f":g=z>-1?(parseFloat(h)||0).toFixed(z):parseFloat(h)||0;break;case"o":g=(parseInt(h)||0).toString(8);break;case"s":g=h;break;case"x":g=(""+(parseInt(h)||0).toString(16)).toLowerCase();break;case"X":g=(""+(parseInt(h)||0).toString(16)).toUpperCase();break;case"h":g=F(h,o);break;case"q":g=F(h,p);break;case"j":g=String.serialize(h);break;case"t":var l=0;var f=0;var d=0;var c=h||0;if(c>60){d=Math.floor(c/60);c=c%60}if(d>60){f=Math.floor(d/60);d=d%60}if(f>24){l=Math.floor(f/24);f=f%24}g=l>0?String.format("%dd %dh %dm %ds",l,f,d,c):String.format("%dh %dm %ds",f,d,c);break;case"m":var G=B?parseInt(B):1000;var v=w?Math.floor(10*parseFloat("0"+w)):2;var x=0;var J=parseFloat(h||0);var u=["","K","M","G","T","P","E"];for(x=0;x<u.length&&J>G;x++){J/=G}g=J.toFixed(v)+" "+u[x];break}}}y+=r+g;s=s.substr(t.length)}return y+s}}XHR=function(){this.reinit=function(){if(window.XMLHttpRequest){this._xmlHttp=new XMLHttpRequest()}else{if(window.ActiveXObject){this._xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}else{alert("xhr.js: XMLHttpRequest is not supported by this browser!")}}};this.busy=function(){if(!this._xmlHttp){return false}switch(this._xmlHttp.readyState){case 1:case 2:case 3:return true;default:return false}};this.abort=function(){if(this.busy()){this._xmlHttp.abort()}};this.get=function(url,data,callback){this.reinit();var xhr=this._xmlHttp;var code=this._encode(data);url=location.protocol+"//"+location.host+url;if(code){if(url.substr(url.length-1,1)=="&"){url+=code}else{url+="?"+code}}xhr.open("GET",url,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){var json=null;if(xhr.getResponseHeader("Content-Type")=="application/json"){try{json=eval("("+xhr.responseText+")")}catch(e){json=null}}callback(xhr,json)}};xhr.send(null)};this.post=function(url,data,callback){this.reinit();var xhr=this._xmlHttp;var code=this._encode(data);xhr.onreadystatechange=function(){if(xhr.readyState==4){callback(xhr)}};xhr.open("POST",url,true);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.setRequestHeader("Content-length",code.length);xhr.setRequestHeader("Connection","close");xhr.send(code)};this.cancel=function(){this._xmlHttp.onreadystatechange=function(){};this._xmlHttp.abort()};this.send_form=function(form,callback,extra_values){var code="";for(var i=0;i<form.elements.length;i++){var e=form.elements[i];if(e.options){code+=(code?"&":"")+form.elements[i].name+"="+encodeURIComponent(e.options[e.selectedIndex].value)}else{if(e.length){for(var j=0;j<e.length;j++){if(e[j].name){code+=(code?"&":"")+e[j].name+"="+encodeURIComponent(e[j].value)}}}else{code+=(code?"&":"")+e.name+"="+encodeURIComponent(e.value)}}}if(typeof extra_values=="object"){for(var key in extra_values){code+=(code?"&":"")+key+"="+encodeURIComponent(extra_values[key])}}return form.method=="get"?this.get(form.getAttribute("action"),code,callback):this.post(form.getAttribute("action"),code,callback)};this._encode=function(obj){obj=obj?obj:{};obj._=Math.random();if(typeof obj=="object"){var code="";var self=this;for(var k in obj){code+=(code?"&":"")+k+"="+encodeURIComponent(obj[k])}return code}return obj}};XHR.get=function(a,c,d){new XHR().get(a,c,d)};XHR.poll=function(a,c,d,e){if(isNaN(a)||a<1){a=5}if(!XHR._q){XHR._t=0;XHR._q=[];XHR._r=function(){for(var f=0,g=XHR._q[0];f<XHR._q.length;g=XHR._q[++f]){if(!(XHR._t%g.interval)&&!g.xhr.busy()){g.xhr.get(g.url,g.data,g.callback)}}XHR._t++}}XHR._q.push({interval:a,callback:e,url:c,data:d,xhr:new XHR()});XHR.run()};XHR.halt=function(){if(XHR._i){try{document.getElementById("xhr_poll_status").style.display="";document.getElementById("xhr_poll_status_on").style.display="none";document.getElementById("xhr_poll_status_off").style.display=""}catch(a){}window.clearInterval(XHR._i);XHR._i=null}};XHR.run=function(){if(XHR._r&&!XHR._i){try{document.getElementById("xhr_poll_status").style.display="";document.getElementById("xhr_poll_status_on").style.display="";document.getElementById("xhr_poll_status_off").style.display="none"}catch(a){}XHR._r();XHR._i=window.setInterval(XHR._r,1000)}};XHR.running=function(){return !!(XHR._r&&XHR._i)};
