<%+header%>
<% if login_fail_cnt and tonumber(login_fail_cnt) >= 5 and relative_time and relative_time < 30 then%>
	<div class="cbi-map-descr"><div class="alert-message error"><%:Your IP login failed too many times, please try again after 30 seconds !%></div><br/></div>
<% else %>
<style type="text/css">
html,body{
position: relative;
height: 100%;
}
.container-maincontent{
background-color: #f3f4eb;
}
.login-container{
position: relative;
width: 300px;
margin-left: auto;
margin-right: auto;
text-align: center;
}
#capStatus{
position:absolute;
visibility:hidden;
z-index:1;
width: 15px;
height: 15px;
margin-top:-45px;
margin-left:55px;
background-image:url('<%=resource%>/icons/capslock.png');
}
.login-form input{
width: 200px;
padding: 10px;
text-align: center;
}
.login-form input[type="text"]{
background-image:url("<%=resource%>/icons/user.png");
background-repeat:no-repeat;
background-position:10px center;
}
.login-form input[type="password"]{
background-image:url("<%=resource%>/icons/password.png");
background-repeat:no-repeat;
background-position:10px center;
}
.cbi-page-actions{
margin-right: 0px;
}
<% if login_fail_cnt and tonumber(login_fail_cnt) >= 3 then %>
#slider {
width: 220px;
height: 40px;
position: relative;
margin-left:auto;
margin-right: auto;
border-radius: 2px;
background-color: #dae2d0;
overflow: hidden;
text-align: center;
user-select: none;
-moz-user-select: none;
-webkit-user-select: none;
}

#slider_bg {
position: absolute;
left: 0;
top: 0;
height: 100%;
background-color: #7AC23C;
z-index: 1;
}

#label {
width: 40px;
position: absolute;
left: 0;
top: 0;
height: 38px;
line-height: 38px;
border: 1px solid #cccccc;
background: #fff;
z-index: 3;
cursor: move;
color: #ff9e77;
font-size: 16px;
font-weight: 900;
}

#labelTip {
position: absolute;
left: 0;
width: 100%;
height: 100%;
font-size: 13px;
font-family: 'Microsoft Yahei', serif;
color: #787878;
line-height: 38px;
text-align: center;
z-index: 2;
}
<% end %>
</style>
<script language=javascript type="text/javascript" src="<%=resource%>/jquery-1.9.1.min.js"></script>
<script language="javascript" type="text/javascript">
var ascii64="./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
var chrsz=8;
function md5crypt(username,password){var tokens={<%=luci.sys.user.get_alluser_passwd_salt()%>};var token=tokens[username];var ctx=password+"$1$"+token;var ctx1=str_md5(password+token+password);for(var pl=password.length;pl>0;pl-=16){ctx+=ctx1.slice(0,(pl>16)?16:pl)}for(var i=password.length;i!=0;i>>=1){if(i&1){ctx+="\0"}else{ctx+=password.charAt(0)}}ctx=str_md5(ctx);for(i=0;i<1000;i++){ctx1="";if(i&1){ctx1+=password}else{ctx1+=ctx}if(i%3){ctx1+=token}if(i%7){ctx1+=password}if(i&1){ctx1+=ctx}else{ctx1+=password}ctx=str_md5(ctx1)}return to64_triplet(ctx,0,6,12)+to64_triplet(ctx,1,7,13)+to64_triplet(ctx,2,8,14)+to64_triplet(ctx,3,9,15)+to64_triplet(ctx,4,10,5)+to64_single(ctx,11)}function to64(v,n){var s="";while(--n>=0){s+=ascii64.charAt(v&63);v>>=6}return s}function to64_triplet(str,idx0,idx1,idx2){var v=(str.charCodeAt(idx0)<<16)|(str.charCodeAt(idx1)<<8)|(str.charCodeAt(idx2));return to64(v,4)}function to64_single(str,idx0){var v=str.charCodeAt(idx0);return to64(v,2)}function core_md5(x,len){x[len>>5]|=128<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn((b&c)|((~b)&d),a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn((b&d)|(c&(~d)),a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|(~d)),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&65535)}function bit_rol(num,cnt){return(num<<cnt)|(num>>>(32-cnt))}function str_md5(s){return binl2str(core_md5(str2binl(s),s.length*chrsz))}function str2binl(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz){bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<(i%32)}return bin}function binl2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<bin.length*32;i+=chrsz){str+=String.fromCharCode((bin[i>>5]>>>(i%32))&mask)}return str};
$(document).ready(function(){
$("input#username").focusin(function(){if($(this).val()=="<%:Username%>"){$(this).val("");}});
$("input#username").focusout(function(){if($(this).val()==""){$(this).val("<%:Username%>");}});
$("input#password").focusin(function(){if($(this).val()=="<%:Password%>"){$(this).val("");}});
$("input#password").focusout(function(){if($(this).val() ==""){$(this).val("<%:Password%>");}});});
function  detectCapsLock(e){
valueCapsLock=e.keyCode?e.keyCode:e.which;
valueShift=e.shiftKey?e.shiftKey:((valueCapsLock==16 )?true:false);
if(((valueCapsLock>=65&&valueCapsLock<=90)&&!valueShift)||((valueCapsLock>=97&&valueCapsLock<=122)&&valueShift))
	document.getElementById('capStatus').style.visibility='visible';
else
	document.getElementById('capStatus').style.visibility='hidden';
}
function form_check(){
	return document.getElementById('password').value=md5crypt(document.getElementById('username').value,document.getElementById('password').value)
}
<% if login_fail_cnt and tonumber(login_fail_cnt) >= 3 then %>
(function(d,c,b,e){function a(k,g,j){var i=this;var f=i.checkElm(k)?d(k):d;j=i.checkFn(j)?j:function(){};var h={successLabelTip:"Successfully Verified",duration:200,swipestart:false,min:0,max:f.width(),index:0,IsOk:false,lableIndex:0};h=d.extend(h,g||{});i.elm=f;i.opts=h;i.swipestart=h.swipestart;i.min=h.min;i.max=h.max;i.index=h.index;i.isOk=h.isOk;i.labelWidth=i.elm.find("#label").width();i.sliderBg=i.elm.find("#slider_bg");i.lableIndex=h.lableIndex;i.success=j}a.prototype.init=function(){var f=this;f.updateView();f.elm.find("#label").on("mousedown",function(g){var h=g||c.event;f.lableIndex=h.clientX-this.offsetLeft;f.handerIn()}).on("mousemove",function(g){f.handerMove(g)}).on("mouseup",function(g){f.handerOut()}).on("mouseout",function(g){f.handerOut()}).on("touchstart",function(g){var h=g||c.event;f.lableIndex=h.originalEvent.touches[0].pageX-this.offsetLeft;f.handerIn()}).on("touchmove",function(g){f.handerMove(g,"mobile")}).on("touchend",function(g){f.handerOut()})};a.prototype.handerIn=function(){var f=this;f.swipestart=true;f.min=0;f.max=f.elm.width()};a.prototype.handerOut=function(){var f=this;f.swipestart=false;if(f.index<f.max){f.reset()}};a.prototype.handerMove=function(h,f){var g=this;if(g.swipestart){h.preventDefault();h=h||c.event;if(f=="mobile"){g.index=h.originalEvent.touches[0].pageX-g.lableIndex}else{g.index=h.clientX-g.lableIndex}g.move()}};a.prototype.move=function(){var f=this;if((f.index+f.labelWidth)>=f.max){f.index=f.max-f.labelWidth-2;f.swipestart=false;f.isOk=true}if(f.index<0){f.index=f.min;f.isOk=false}if(f.index+f.labelWidth+2==f.max&&f.max>0&&f.isOk){d("#label").unbind().next("#labelTip").text(f.opts.successLabelTip).css({color:"#fff"});f.success()}f.updateView()};a.prototype.updateView=function(){var f=this;f.sliderBg.css("width",f.index);f.elm.find("#label").css("left",f.index+"px")};a.prototype.reset=function(){var f=this;f.index=0;f.sliderBg.animate({width:0},f.opts.duration);f.elm.find("#label").animate({left:f.index},f.opts.duration).next("#lableTip").animate({opacity:1},f.opts.duration);f.updateView()};a.prototype.checkElm=function(f){if(d(f).length>0){return true}else{throw"this element does not exist."}};a.prototype.checkFn=function(f){if(typeof f==="function"){return true}else{throw"the param is not a function."}};c.SliderUnlock=a})(jQuery,window,document);
<% end %>
</script>
<%- if fuser then %><div class="cbi-map-descr"><div class="alert-message error"><%:Invalid username and/or password! Please try again.%></div><br/></div><% end -%>
<div class="login-container">
	<div class="login-form">
		<form id="login" method="post" action="/luci" onsubmit="return form_check()">
		<script language="javascript" type="text/javascript">
			var str = ""
			<% if (not luci.version.firmware_ver:match("^1%.")) and luci.version.oem and luci.version.oem.logo then%>
			str += "<div style='padding:15px'><img src='/luci-static/resources/<%=luci.version.oem.logo%>'></div>"
			<% end %>
			str += "<div style='padding:15px'><input class='cbi-value' id='username' name='username' type='text' value='<%:Username%>'>"
			str += "<input class='cbi-value' id='password' name='password' type='password' onkeypress='detectCapsLock(event)' value='<%:Password%>'>"
			str += "<div id='capStatus'></div>"
		<% if login_fail_cnt and tonumber(login_fail_cnt) < 3 then %>
			str += "<input type='submit' value='<%:Login%>' class='cbi-button cbi-button-apply cbi-page-actions' /></div>"
		<% else %>
			str += "<div id='slider'><div id='slider_bg' style='width: 0px;'></div><span id='label' style='left: 0px;'>&gt;&gt;</span><span id='labelTip'><%:Please Slide to Login%></span></div>"
		<% end %>
			document.write(str)
		</script>
		<% if login_fail_cnt and tonumber(login_fail_cnt) >= 3 then %>
		<script>$(function(){var slider = new SliderUnlock('#slider',{successLabelTip:'<%:Verify OK%>'},function(){form_check();document.forms["login"].submit()});slider.init();})</script>
		<% end %>
		</form>
	</div>
</div>
<% end %>
<%+footer%>
