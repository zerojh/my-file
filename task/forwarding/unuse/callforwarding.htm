<div class="cbi-value<% if self.last_child then %> cbi-value-last<% end %>" <% if #self.deps > 0  then	%>style="display:none"<%end%> id="cbi-<%=self.config.."-"..section.."-"..self.option%>">

<div class="cbi-value-title"><label style="margin-left:<%=self.margin%>;"><%-=self.title or ""-%></label></div>
<div class="cbi-value-field" style="width:45%;">
<%-
	local value_list = self:cfgvalue(section);

	if "table" == type(value_list) then
		for k,v in pairs(value_list) do %>
		<div>
			<select class="cbi-input-select" style="width:<%=value_list and value_list[1] and value_list[1][1] and value_list[1][1] ~= "Deactivate" and "28%" or "46%"%>;" size="1"<%=attr("id",cbid)..attr("name",cbid.."-select0")%>>
			<%- for i, key in pairs(self.s1_keylist) do %>
				<option id="option0"<%=attr("value",key)..ifattr(v[1]==key,"selected","selected")%>><%=striptags(self.s1_vallist[i])%></option>
			<%- end %>
			</select>
			<label <%=(v[1] and v[1] ~= "Deactivate") and '' or 'style="display:none;"'%>>&nbsp;</label>
			<select class="cbi-input-select" style="width:17%;<%=(v[1] and v[1] ~= "Deactivate") and "" or "display:none;"%>" size="1"<%=attr("id",cbid.."-select1."..k)%>>
			<%- for i, key in pairs(self.s2_keylist) do %>
				<option id="option1"<%=attr("value",key)..ifattr(v[2]==key,"selected","selected")%>><%=striptags(self.s2_vallist[i])%></option>
			<%- end %>
			</select>
			<%-
				local flag = false;
				if self.id_keylist then
					if type(self.id_keylist) == "string" then
						if v[1] == self.vallist then
							flag = true
						end
					elseif type(self.id_keylist) == "table" and next(self.id_keylist) then
						for _,j in pairs(self.id_keylist) do
							if v[1] == j then
								flag = true
							end
						end
					end
				end
				if flag then
			%>
			<label style="display:;">&nbsp;<%:Dest Number%>&nbsp;</label>
			<input class="cbi-input-text" type="text" style="width:16%;"<%=ifattr(v[3],"value",v[3])..attr("id",cbid.."-input."..k)..attr("name",cbid.."-input")%>>
			<%-else%>
			<label style="display:none;">&nbsp;<%:Dest Number%>&nbsp;</label>
			<input class="cbi-input-text" type="text" style="width:16%;display:none;"<%=attr("id",cbid.."-input."..k)..attr("name",cbid.."-input")%>>
			<%-end%>
			<input type="text" style="width:5%;display:none;"<%=ifattr(v["whole"],"value",v["whole"])..attr("name",cbid)%>>
		</div>
		<%-end
	elseif "nil" == type(value_list) then%>
		<div>
			<select class="cbi-input-select" style="width:46%;" size="1"<%=attr("id",cbid)..attr("name",cbid.."-select0")%>>
			<%- for i, key in pairs(self.s1_keylist) do %>
				<option id="option0"<%=attr("value",key)%>><%=striptags(self.s1_vallist[i])%></option>
			<%- end %>
			</select>
			<label style="display:none;">&nbsp;</label>
			<select class="cbi-input-select" style="width:17%;display:none;" size="1"<%=attr("id",cbid.."-select1.1")%>>
			<% for i, key in pairs(self.s2_keylist) do -%>
				<option id="option1"<%=attr("value",key)%>><%=striptags(self.s2_vallist[i])%></option>
			<%end%>
			</select>
			<label style="display:none;">&nbsp;<%:Dest Number%>&nbsp;</label>
			<input class="cbi-input-text" type="text" style="width:16%;display:none;"<%=attr("id",cbid.."-input.1")..attr("name",cbid.."-input")%>>
			<input type="text" style="width:5%;display:none;"<%=attr("name",cbid)%>>
		</div>
	<%-end
%>
</div>
<script type="text/javascript">
cbi_callforwarding_init("<%=cbid%>-select0","<%=resource%>", [
	<%-
		if self.id_keylist then
			if type(self.id_keylist) == "string" then -%>
				<%-=self.id_keylist-%>
		<%-
			elseif type(self.id_keylist) == "table" and next(self.id_keylist) then
				for k,v in pairs(self.id_keylist) do -%>
					"<%-=v-%>"
					<%-if k<#self.id_keylist then-%>,<%-end-%>
				<%- end
			end
		end
	-%>
]);
</script>

<div <%=attr("id", cbid.."-input.tip")%> class="cbi-input-tip" style="display:none;width:15%;margin-left:-10px;">
	<div style="display:table-cell;vertical-align:middle;">
		<%- local datatype_tip = require "luci.cbi.datatypes".get_datatypes_tip("phonenumber") %>
		<%=translate(tostring(datatype_tip))%>
	</div>
</div>

</div>
<% if #self.deps > 0 or #self.subdeps > 0 then -%>
	<script type="text/javascript" id="cbip-<%=self.config.."-"..section.."-"..self.option%>">
		<% for j, d in ipairs(self.subdeps) do -%>
			cbi_d_add("cbi-<%=self.config.."-"..section.."-"..self.option..d.add%>", {
		<%-
			for k,v in pairs(d.deps) do
				local depk
				if k:find("!", 1, true) then
					depk = string.format('"%s"', k)
				elseif k:find(".", 1, true) then
					depk = string.format('"cbid.%s"', k)
				else
					depk = string.format('"cbid.%s.%s.%s"', self.config, section, k)
				end
		-%>
			<%-= depk .. ":" .. string.format("%q", v)-%>
			<%-if next(d.deps, k) then-%>,<%-end-%>
		<%-
			end
		-%>
			}, "cbip-<%=self.config.."-"..section.."-"..self.option..d.add%>");
		<%- end %>
		<% for j, d in ipairs(self.deps) do -%>
			cbi_d_add("cbi-<%=self.config.."-"..section.."-"..self.option..d.add%>", {
		<%-
			for k,v in pairs(d.deps) do
				local depk
				if k:find("!", 1, true) then
					depk = string.format('"%s"', k)
				elseif k:find(".", 1, true) then
					depk = string.format('"cbid.%s"', k)
				else
					depk = string.format('"cbid.%s.%s.%s"', self.config, section, k)
				end
		-%>
			<%-= depk .. ":" .. string.format("%q", v)-%>
			<%-if next(d.deps, k) then-%>,<%-end-%>
		<%-
			end
		-%>
			}, "cbip-<%=self.config.."-"..section.."-"..self.option..d.add%>");
		<%- end %>
	</script>
<%- end %>
