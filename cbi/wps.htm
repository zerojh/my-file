<%+cbi/valueheader%>

<script type="text/javascript">

	function check_input_pin(id)
	{
		var val = document.getElementById(id).value
		if (val.length == 4 || val.length == 8)
		{
			$('#'+id).attr("class","cbi-input-text")
			document.getElementById('pin').disabled = false
		}
		else
		{
			if (val.length != 0)
			{
				$('#'+id).attr("class","cbi-input-invalid")
			}
			else
			{
				$('#'+id).attr("class","cbi-input-text")
			}
			document.getElementById('pin').disabled = true
		}
	}
	
	function action_wps(bt)
	{
		var bt_name = bt.name
		var pin_code = document.getElementById('pin_code').value

		document.getElementById('pin_code').disabled = true
		var status = document.getElementById('pin').disabled
		document.getElementById('pin').disabled = true
		document.getElementById('pbc').disabled = true
		$('#con_status').show()
		$('#con_status').text('<%:Connecting...%>'+' ...... 1')
		
		XHR.get('<%=luci.dispatcher.build_url("admin", "network", "wps")%>',{action_type:bt_name,pin_code:pin_code},
		function(x,info){
			var timeuse = 0
			
			var this_id = window.setInterval(function(){
				var break_flag = false
				
				XHR.get('<%=luci.dispatcher.build_url("admin", "network", "wps")%>',{ status:1 },
				function(x,info){
					timeuse = timeuse + 5
					
					if (info.status == "2")
					{
						$('#con_status').text('<%:Failed%>'+' ...... '+timeuse)
						break_flag = true
					}
					else if (info.status == "34")
					{
						$('#con_status').text('<%:Connected%>'+' ...... '+timeuse)
						break_flag = true
					}
					else
					{
						$('#con_status').text('<%:Connecting...%>'+' ...... '+timeuse)
						break_flag = false
					}
				})

				if (break_flag == true || timeuse > 120 )
				{
					document.getElementById('pin_code').disabled = false
					document.getElementById('pin').disabled = status
					document.getElementById('pbc').disabled = false	
					window.clearInterval(this_id)
				}
			},5000)
		})
	}
	
//]]></script>

<input class="cbi-input-text" type="text" onkeyup="check_input_pin(this.id)" name="pin_code" id="pin_code"> </input>
<br>
&nbsp;
<br>
<input disabled type="button" class="cbi-button" id="pin" name="pin" style="font-size: 14px;padding:5px 33px;" value="<%:PIN%>" onclick="return action_wps(this)" />
<input type="button" class="cbi-button" id="pbc" name="pbc" style="font-size: 14px;padding:5px 33px;" value="<%:PBC%>" onclick="return action_wps(this)" />
<br>
&nbsp;
<br>
<label hidden id='con_status' ></label>

<%+cbi/valuefooter%>

